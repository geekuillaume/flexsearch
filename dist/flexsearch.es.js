function t(t,e){return void 0!==t?t:e}function e(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=i();return e}function i(){return Object.create(null)}function n(t,e){return e.length-t.length}function s(t){return t.constructor===Array}function r(t){return"string"==typeof t}function h(t){return"object"==typeof t}function o(t){return"function"==typeof t}function l(t,e,i,n){if(t&&(e&&(t=u(t,e)),this.matcher&&(t=u(t,this.matcher)),this.stemmer&&t.length>1&&(t=u(t,this.stemmer)),n&&t.length>1&&(t=function(t){let e="",i="";for(let n,s=0,r=t.length;s<r;s++)(n=t[s])!==i&&(e+=i=n);return e}(t)),i||""===i)){const e=t.split(i);return this.filter?function(t,e){const i=t.length,n=[];for(let s=0,r=0;s<i;s++){const i=t[s];i&&!e[i]&&(n[r++]=i)}return n}(e,this.filter):e}return t}const c=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function f(t,e){const i=function(t){return Object.keys(t)}(t),n=i.length,s=[];let r="",h=0;for(let o,l,c=0;c<n;c++)o=i[c],l=t[o],l?(s[h++]=a(e?"(?!\\b)"+o+"(\\b|_)":o),s[h++]=l):r+=(r?"|":"")+o;return r&&(s[h++]=a(e?"(?!\\b)("+r+")(\\b|_)":"("+r+")"),s[h]=""),s}function u(t,e){for(let i=0,n=e.length;i<n&&(t=t.replace(e[i],e[i+1]));i+=2);return t}function a(t){return new RegExp(t,"g")}function g(t){return l.call(this,(""+t).toLowerCase(),!1,c,!1)}function d(t){p(t,"add"),p(t,"append"),p(t,"search"),p(t,"update"),p(t,"remove")}function p(t,e){t[e+"Async"]=function(){const t=this,i=arguments,n=i[i.length-1];let s;o(n)&&(s=n,delete i[i.length-1]);const r=new Promise((function(n){setTimeout((function(){t.async=!0;const s=t[e].apply(t,i);t.async=!1,n(s)}))}));return s?(r.then(s),this):r}}function m(t,e,n,s){const r=t.length;let h,o,l=[],c=0;s&&(s=[]);for(let f=r-1;f>=0;f--){const u=t[f],a=u.length,g=i();let d=!h;for(let t=0;t<a;t++){const i=u[t],a=i.length;if(a)for(let t,u,p=0;p<a;p++)if(u=i[p],h){if(h[u]){if(!f)if(n)n--;else if(l[c++]=u,c===e)return l;(f||s)&&(g[u]=1),d=!0}if(s&&(t=o[u],o[u]=t?++t:t=1,t<r)){const e=s[t-2]||(s[t-2]=[]);e[e.length]=u}}else g[u]=1}if(s)h||(o=g);else if(!d)return[];h=g}if(s)for(let t,i,r=s.length-1;r>=0;r--){t=s[r],i=t.length;for(let s,r=0;r<i;r++)if(s=t[r],!h[s]){if(n)n--;else if(l[c++]=s,c===e)return l;h[s]=1}}return l}function x(t,e){const n=i(),s=i(),r=[];for(let e=0;e<t.length;e++)n[t[e]]=1;for(let t,i=0;i<e.length;i++){t=e[i];for(let e,i=0;i<t.length;i++)e=t[i],n[e]&&(s[e]||(s[e]=1,r[r.length]=e))}return r}function y(t){this.limit=!0!==t&&t,this.cache=i(),this.queue=[]}function b(t,e,i){h(t)&&(t=t.query);let n=this.cache.get(t);return n||(n=this.search(t,e,i),this.cache.set(t,n)),n}y.prototype.set=function(t,e){if(!this.cache[t]){let e=this.queue.length;e===this.limit?delete this.cache[this.queue[e-1]]:e++;for(let t=e-1;t>0;t--)this.queue[t]=this.queue[t-1];this.queue[0]=t}this.cache[t]=e},y.prototype.get=function(t){const e=this.cache[t];if(this.limit&&e){const e=this.queue.indexOf(t);if(e){const t=this.queue[e-1];this.queue[e-1]=this.queue[e],this.queue[e]=t}}return e},y.prototype.del=function(t){for(let e,i,n=0;n<this.queue.length;n++)i=this.queue[n],e=this.cache[i],-1!==e.indexOf(t)&&(this.queue.splice(n--,1),delete this.cache[i])};
/**!
 * FlexSearch.js
 * Copyright 2018-2021 Nextapps GmbH
 * Author: Thomas Wilkerling
 * Licence: Apache-2.0
 * https://github.com/nextapps-de/flexsearch
 */
class k{constructor(n={}){this.encode=g,this.register=i(),this.resolution=n.resolution||9,this.tokenize=n.tokenize||"strict",this.depth=n?.context?.depth,this.bidirectional=t(n?.context?.bidirectional,!0),this.optimize=t(n.optimize,!0),this.minlength=n.minlength||1,this.boost=n.boost,this.map=this.optimize?e(n?.context?.resolution||9):i(),this.resolution_ctx=n?.context?.resolution||1,this.ctx=this.optimize?e(n?.context?.resolution||1):i(),this.rtl=n.rtl,this.matcher=n.matcher&&f(n.matcher,!1),this.stemmer=n.stemmer&&f(n.stemmer,!0),this.filter=n.filter&&function(t){const e=i();for(let i=0,n=t.length;i<n;i++)e[t[i]]=1;return e}(n.filter),this.cache=n.cache&&new y(n.cache)}append(t,e){return this.add(t,e,!0)}add(t,e,n,s){if(e&&(t||0===t)){if(!s&&!n&&this.register[t])return this.update(t,e);const r=(e=this.encode(e)).length;if(r){const s=i(),h=i(),o=this.depth,l=this.resolution;for(let c=0;c<r;c++){let f=e[this.rtl?r-1-c:c],u=f.length;if(f&&u>=this.minlength&&(o||!h[f])){let a=z(l,r,c),g="";switch(this.tokenize){case"full":if(u>3){for(let e=0;e<u;e++)for(let i=u;i>e;i--)if(i-e>=this.minlength){const s=z(l,r,c,u,e);g=f.substring(e,i),this.push_index(h,g,s,t,n)}break}case"reverse":if(u>2){for(let e=u-1;e>0;e--)if(g=f[e]+g,g.length>=this.minlength){const i=z(l,r,c,u,e);this.push_index(h,g,i,t,n)}g=""}case"forward":if(u>1){for(let e=0;e<u;e++)g+=f[e],g.length>=this.minlength&&this.push_index(h,g,a,t,n);break}default:if(this.boost&&(a=Math.min(a/this.boost(e,f,c)|0,l-1)),this.push_index(h,f,a,t,n),o&&r>1&&c<r-1){const h=i(),l=this.resolution_ctx,u=f,a=Math.min(o+1,r-c);h[u]=1;for(let i=1;i<a;i++)if(f=e[this.rtl?r-1-c-i:c+i],f&&f.length>=this.minlength&&!h[f]){h[f]=1;const e=z(l+(r/2>l?0:1),r,c,a-1,i-1),o=this.bidirectional&&f>u;this.push_index(s,o?u:f,e,t,n,o?f:u)}}}}}}}return this}push_index(t,e,n,s,r,h){let o=h?this.ctx:this.map;(!t[e]||h&&!t[e][h])&&(this.optimize&&(o=o[n]),h?((t=t[e]||(t[e]=i()))[h]=1,o=o[h]||(o[h]=i())):t[e]=1,o=o[e]||(o[e]=[]),this.optimize||(o=o[n]||(o[n]=[])),r&&-1!==o.indexOf(s)||(o[o.length]=s))}search(t,e,s){s||(!e&&h(t)?t=(s=t).query:h(e)&&(s=e));let r,o,l,c=[],f=0;if(s&&(e=s.limit,f=s.offset||0,o=s.context,l=s.suggest),t&&(r=(t=this.encode(t)).length,r>1)){const e=i(),n=[];for(let i,s=0,h=0;s<r;s++)if(i=t[s],i&&i.length>=this.minlength&&!e[i]){if(!(this.optimize||l||this.map[i]))return c;n[h++]=i,e[i]=1}r=(t=n).length}if(!r)return c;e||(e=100);let u,a,g,d=this.depth&&r>1&&!1!==o,p=0;for(d?(u=t[0],p=1):r>1&&t.sort(n);p<r;p++){if(g=t[p],d?(a=this.add_result(c,l,e,f,2===r,g,u),l&&!1===a&&c.length||(u=g)):a=this.add_result(c,l,e,f,1===r,g),a)return a;if(l&&p===r-1){let t=c.length;if(!t){if(d){d=0,p=-1;continue}return c}if(1===t)return w(c[0],e,f)}}return m(c,e,f,l)}add_result(t,e,i,n,s,r,h){let o=[],l=h?this.ctx:this.map;if(this.optimize||(l=q(l,r,h,this.bidirectional)),l){let e=0;const c=Math.min(l.length,h?this.resolution_ctx:this.resolution);for(let t,f,u=0,a=0;u<c&&(t=l[u],!(t&&(this.optimize&&(t=q(t,r,h,this.bidirectional)),n&&t&&s&&(f=t.length,f<=n?(n-=f,t=null):(t=t.slice(n),n=0)),t&&(o[e++]=t,s&&(a+=t.length,a>=i)))));u++);if(e)return s?w(o,i,0):void(t[t.length]=o)}return!e&&o}contain(t){return!!this.register[t]}update(t,e){return this.remove(t).add(t,e)}remove(t,e){return this.register[t]&&(_(this.map,t,this.resolution,this.optimize),this.depth&&_(this.ctx,t,this.resolution_ctx,this.optimize),e||delete this.register[t],this.cache&&this.cache.del(t)),this}serialize(){return{reg:this.register,opt:this.optimize,map:this.map,ctx:this.ctx}}static deserialize(t,e){const i=new k(e);return i.optimize=t.opt,i.register=t.reg,i.map=t.map,i.ctx=t.ctx,i}}function z(t,e,i,n,s){return i&&t>1?e+(n||0)<=t?i+(s||0):(t-1)/(e+(n||0))*(i+(s||0))+1|0:0}function w(t,e,i){var n;return 1===t.length?t=t[0]:(n=t,t=[].concat.apply([],n)),i||t.length>e?t.slice(i,i+e):t}function q(t,e,i,n){if(i){const s=n&&e>i;t=(t=t[s?e:i])&&t[s?i:e]}else t=t[e];return t}function _(t,e,i,n,r){let h=0;if(s(t))if(r){const i=t.indexOf(e);-1!==i?t.length>1&&(t.splice(i,1),h++):h++}else{r=Math.min(t.length,i);for(let s,o=0;o<r;o++)s=t[o],s&&(h=_(s,e,i,n,r),n||h||delete t[o])}else for(let s in t)h=_(t[s],e,i,n,r),h||delete t[s];return h}k.prototype.searchCache=b,d(k.prototype);
/**!
 * FlexSearch.js
 * Copyright 2018-2021 Nextapps GmbH
 * Author: Thomas Wilkerling
 * Licence: Apache-2.0
 * https://github.com/nextapps-de/flexsearch
 */
class O{constructor(t){const e=t.document||t.doc||t;let n;this.tree=[],this.field=[],this.marker=[],this.register=i(),this.key=(n=e.key||e.id)&&v(n,this.marker)||"id",this.storetree=(n=e.store)&&!0!==n&&[],this.store=n&&i(),this.tag=(n=e.tag)&&v(n,this.marker),this.tagindex=n&&i(),this.cache=(n=t.cache)&&new y(n),t.cache=!1,this.worker=t.worker,this.async=!1,this.index=this.parse_descriptor(t,e)}add(t,e,n){if(h(t)&&(t=j(e=t,this.key)),e&&(t||0===t)){if(!n&&this.register[t])return this.update(t,e);for(let i,s,h=0;h<this.field.length;h++)s=this.field[h],i=this.tree[h],r(i)&&(i=[i]),C(e,i,this.marker,0,this.index[s],t,i[0],n);if(this.tag){let s=j(e,this.tag),h=i();r(s)&&(s=[s]);for(let e,i,r=0;r<s.length;r++)e=s[r],h[e]||(h[e]=1,i=this.tagindex[e]||(this.tagindex[e]=[]),n&&-1!==i.indexOf(t)||(i[i.length]=t))}if(this.store&&(!n||!this.store[t])){let n;if(this.storetree){n=i();for(let t,i=0;i<this.storetree.length;i++)t=this.storetree[i],r(t)?n[t]=e[t]:A(e,n,t,0,t[0])}this.store[t]=n||e}}return this}append(t,e){return this.add(t,e,!0)}update(t,e){return this.remove(t).add(t,e)}remove(t){if(h(t)&&(t=j(t,this.key)),this.register[t]){for(let e=0;e<this.field.length;e++)this.index[this.field[e]].remove(t,!this.worker);if(this.tag)for(let e in this.tagindex){const i=this.tagindex[e],n=i.indexOf(t);-1!==n&&(i.length>1?i.splice(n,1):delete this.tagindex[e])}this.store&&delete this.store[t],delete this.register[t]}return this}search(t,e,i,n){i||(!e&&h(t)?t=(i=t).query:h(e)&&(i=e,e=0));let o,l,c,f,u,a,g=[],d=[],p=0;if(i)if(s(i))c=i,i=null;else{if(o=i.pluck,c=o||i.index||i.field,f=i.tag,l=this.store&&i.enrich,u="and"===i.bool,e=i.limit||100,a=i.offset||0,f&&(r(f)&&(f=[f]),!t)){for(let t,i=0;i<f.length;i++)t=M.call(this,f[i],e,a,l),t&&(g[g.length]=t,p++);return p?g:[]}r(c)&&(c=[c])}c||(c=this.field),u=u&&(c.length>1||f&&f.length>1);const y=!n&&(this.worker||this.async)&&[];for(let s,h,o,l=0;l<c.length;l++){let b;if(h=c[l],r(h)||(b=h,h=h.field),y)y[l]=this.index[h].searchAsync(t,e,b||i);else{if(s=n?n[l]:this.index[h].search(t,e,b||i),o=s&&s.length,f&&o){const t=[];let i=0;u&&(t[0]=[s]);for(let e,n,s=0;s<f.length;s++)e=f[s],n=this.tagindex[e],o=n&&n.length,o&&(i++,t[t.length]=u?[n]:n);i&&(s=u?m(t,e||100,a||0):x(s,t),o=s.length)}if(o)d[p]=h,g[p++]=s;else if(u)return[]}}if(y){const n=this;return new Promise((function(s){Promise.all(y).then((function(r){s(n.search(t,e,i,r))}))}))}if(!p)return[];if(o&&(!l||!this.store))return g[0];for(let t,e=0;e<d.length;e++){if(t=g[e],t.length&&l&&(t=P.call(this,t)),o)return t;g[e]={"field":d[e],"result":t}}return g}contain(t){return!!this.register[t]}get(t){return this.store[t]}set(t,e){return this.store[t]=e,this}serialize(){const t={tag:this.tagIndex,reg:this.register,store:this.store,field:this.field,index:{}};return Object.entries(this.index).forEach((([e,i])=>{t.index[e]=i.serialize()})),t}static deserialize(t,e){const i=new O(e);return i.tagIndex=t.tag,i.register=t.reg,i.store=t.store,i.field=t.field,Object.entries(t.index).forEach((([e,n])=>{i.index[e]=k.deserialize(n),i.index[e].register=t.reg})),i}parse_descriptor(t,e){const n=i();let s=e.index||e.field||e;r(s)&&(s=[s]);for(let e,i,o=0;o<s.length;o++)e=s[o],r(e)||(i=e,e=e.field),i=h(i)?Object.assign({},t,i):t,this.worker||(n[e]=new k(i,this.register)),this.tree[o]=v(e,this.marker),this.field[o]=e;if(this.storetree){let t=e.store;r(t)&&(t=[t]);for(let e=0;e<t.length;e++)this.storetree[e]=v(t[e],this.marker)}return n}}function v(t,e){const i=t.split(":");let n=0;for(let s=0;s<i.length;s++)(t=i[s]).indexOf("[]")>=0&&(t=t.substring(0,t.length-2))&&(e[n]=!0),t&&(i[n++]=t);return n<i.length&&(i.length=n),n>1?i:i[0]}function j(t,e){if(r(e))t=t[e];else for(let i=0;t&&i<e.length;i++)t=t[e[i]];return t}function A(t,e,n,r,h){if(t=t[h],r===n.length-1)e[h]=t;else if(t)if(s(t)){e=e[h]=new Array(t.length);for(let i=0;i<t.length;i++)A(t,e,n,r,i)}else e=e[h]||(e[h]=i()),h=n[++r],A(t,e,n,r,h)}function C(t,e,i,n,r,h,o,l){if(t=t[o])if(n===e.length-1){if(s(t)){if(i[n]){for(let e=0;e<t.length;e++)r.add(h,t[e],!0,!0);return}t=t.join(" ")}r.add(h,t,l,!0)}else if(s(t))for(let s=0;s<t.length;s++)C(t,e,i,n,r,h,s,l);else o=e[++n],C(t,e,i,n,r,h,o,l)}function M(t,e,i,n){let s=this.tagindex[t],r=s&&s.length-i;if(r&&r>0)return(r>e||i)&&(s=s.slice(i,i+e)),n&&(s=P.call(this,s)),{"tag":t,"result":s}}function P(t){const e=new Array(t.length);for(let i,n=0;n<t.length;n++)i=t[n],e[n]={"id":i,"doc":this.store[i]};return e}O.prototype.searchCache=b,d(O.prototype);export{O as Document,k as Index};
//# sourceMappingURL=flexsearch.es.js.map
