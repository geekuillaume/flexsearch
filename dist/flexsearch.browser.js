!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).flexsearch={})}(this,(function(t){"use strict";function e(t,e){return void 0!==t?t:e}function i(t){const e=new Array(t);for(let i=0;i<t;i++)e[i]=n();return e}function n(){return Object.create(null)}function s(t,e){return e.length-t.length}function r(t){return t.constructor===Array}function h(t){return"string"==typeof t}function o(t){return"object"==typeof t}function l(t){return"function"==typeof t}function c(t,e,i,n){if(t&&(e&&(t=a(t,e)),this.matcher&&(t=a(t,this.matcher)),this.stemmer&&t.length>1&&(t=a(t,this.stemmer)),n&&t.length>1&&(t=function(t){let e="",i="";for(let n,s=0,r=t.length;s<r;s++)(n=t[s])!==i&&(e+=i=n);return e}(t)),i||""===i)){const e=t.split(i);return this.filter?function(t,e){const i=t.length,n=[];for(let s=0,r=0;s<i;s++){const i=t[s];i&&!e[i]&&(n[r++]=i)}return n}(e,this.filter):e}return t}const f=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function u(t,e){const i=function(t){return Object.keys(t)}(t),n=i.length,s=[];let r="",h=0;for(let o,l,c=0;c<n;c++)o=i[c],l=t[o],l?(s[h++]=g(e?"(?!\\b)"+o+"(\\b|_)":o),s[h++]=l):r+=(r?"|":"")+o;return r&&(s[h++]=g(e?"(?!\\b)("+r+")(\\b|_)":"("+r+")"),s[h]=""),s}function a(t,e){for(let i=0,n=e.length;i<n&&(t=t.replace(e[i],e[i+1]));i+=2);return t}function g(t){return new RegExp(t,"g")}function d(t){return c.call(this,(""+t).toLowerCase(),!1,f,!1)}function p(t){m(t,"add"),m(t,"append"),m(t,"search"),m(t,"update"),m(t,"remove")}function m(t,e){t[e+"Async"]=function(){const t=this,i=arguments,n=i[i.length-1];let s;l(n)&&(s=n,delete i[i.length-1]);const r=new Promise((function(n){setTimeout((function(){t.async=!0;const s=t[e].apply(t,i);t.async=!1,n(s)}))}));return s?(r.then(s),this):r}}function x(t,e,i,s){const r=t.length;let h,o,l=[],c=0;s&&(s=[]);for(let f=r-1;f>=0;f--){const u=t[f],a=u.length,g=n();let d=!h;for(let t=0;t<a;t++){const n=u[t],a=n.length;if(a)for(let t,u,p=0;p<a;p++)if(u=n[p],h){if(h[u]){if(!f)if(i)i--;else if(l[c++]=u,c===e)return l;(f||s)&&(g[u]=1),d=!0}if(s&&(t=o[u],o[u]=t?++t:t=1,t<r)){const e=s[t-2]||(s[t-2]=[]);e[e.length]=u}}else g[u]=1}if(s)h||(o=g);else if(!d)return[];h=g}if(s)for(let t,n,r=s.length-1;r>=0;r--){t=s[r],n=t.length;for(let s,r=0;r<n;r++)if(s=t[r],!h[s]){if(i)i--;else if(l[c++]=s,c===e)return l;h[s]=1}}return l}function y(t,e){const i=n(),s=n(),r=[];for(let e=0;e<t.length;e++)i[t[e]]=1;for(let t,n=0;n<e.length;n++){t=e[n];for(let e,n=0;n<t.length;n++)e=t[n],i[e]&&(s[e]||(s[e]=1,r[r.length]=e))}return r}function b(t){this.limit=!0!==t&&t,this.cache=n(),this.queue=[]}function k(t,e,i){o(t)&&(t=t.query);let n=this.cache.get(t);return n||(n=this.search(t,e,i),this.cache.set(t,n)),n}b.prototype.set=function(t,e){if(!this.cache[t]){let e=this.queue.length;e===this.limit?delete this.cache[this.queue[e-1]]:e++;for(let t=e-1;t>0;t--)this.queue[t]=this.queue[t-1];this.queue[0]=t}this.cache[t]=e},b.prototype.get=function(t){const e=this.cache[t];if(this.limit&&e){const e=this.queue.indexOf(t);if(e){const t=this.queue[e-1];this.queue[e-1]=this.queue[e],this.queue[e]=t}}return e},b.prototype.del=function(t){for(let e,i,n=0;n<this.queue.length;n++)i=this.queue[n],e=this.cache[i],-1!==e.indexOf(t)&&(this.queue.splice(n--,1),delete this.cache[i])};
/**!
   * FlexSearch.js
   * Copyright 2018-2021 Nextapps GmbH
   * Author: Thomas Wilkerling
   * Licence: Apache-2.0
   * https://github.com/nextapps-de/flexsearch
   */
class z{constructor(t={}){this.encode=d,this.register=n(),this.resolution=t.resolution||9,this.tokenize=t.tokenize||"strict",this.depth=t?.context?.depth,this.bidirectional=e(t?.context?.bidirectional,!0),this.optimize=e(t.optimize,!0),this.minlength=t.minlength||1,this.boost=t.boost,this.map=this.optimize?i(t?.context?.resolution||9):n(),this.resolution_ctx=t?.context?.resolution||1,this.ctx=this.optimize?i(t?.context?.resolution||1):n(),this.rtl=t.rtl,this.matcher=t.matcher&&u(t.matcher,!1),this.stemmer=t.stemmer&&u(t.stemmer,!0),this.filter=t.filter&&function(t){const e=n();for(let i=0,n=t.length;i<n;i++)e[t[i]]=1;return e}(t.filter),this.cache=t.cache&&new b(t.cache)}append(t,e){return this.add(t,e,!0)}add(t,e,i,s){if(e&&(t||0===t)){if(!s&&!i&&this.register[t])return this.update(t,e);const r=(e=this.encode(e)).length;if(r){const s=n(),h=n(),o=this.depth,l=this.resolution;for(let c=0;c<r;c++){let f=e[this.rtl?r-1-c:c],u=f.length;if(f&&u>=this.minlength&&(o||!h[f])){let a=w(l,r,c),g="";switch(this.tokenize){case"full":if(u>3){for(let e=0;e<u;e++)for(let n=u;n>e;n--)if(n-e>=this.minlength){const s=w(l,r,c,u,e);g=f.substring(e,n),this.push_index(h,g,s,t,i)}break}case"reverse":if(u>2){for(let e=u-1;e>0;e--)if(g=f[e]+g,g.length>=this.minlength){const n=w(l,r,c,u,e);this.push_index(h,g,n,t,i)}g=""}case"forward":if(u>1){for(let e=0;e<u;e++)g+=f[e],g.length>=this.minlength&&this.push_index(h,g,a,t,i);break}default:if(this.boost&&(a=Math.min(a/this.boost(e,f,c)|0,l-1)),this.push_index(h,f,a,t,i),o&&r>1&&c<r-1){const h=n(),l=this.resolution_ctx,u=f,a=Math.min(o+1,r-c);h[u]=1;for(let n=1;n<a;n++)if(f=e[this.rtl?r-1-c-n:c+n],f&&f.length>=this.minlength&&!h[f]){h[f]=1;const e=w(l+(r/2>l?0:1),r,c,a-1,n-1),o=this.bidirectional&&f>u;this.push_index(s,o?u:f,e,t,i,o?f:u)}}}}}}}return this}push_index(t,e,i,s,r,h){let o=h?this.ctx:this.map;(!t[e]||h&&!t[e][h])&&(this.optimize&&(o=o[i]),h?((t=t[e]||(t[e]=n()))[h]=1,o=o[h]||(o[h]=n())):t[e]=1,o=o[e]||(o[e]=[]),this.optimize||(o=o[i]||(o[i]=[])),r&&-1!==o.indexOf(s)||(o[o.length]=s))}search(t,e,i){i||(!e&&o(t)?t=(i=t).query:o(e)&&(i=e));let r,h,l,c=[],f=0;if(i&&(e=i.limit,f=i.offset||0,h=i.context,l=i.suggest),t&&(r=(t=this.encode(t)).length,r>1)){const e=n(),i=[];for(let n,s=0,h=0;s<r;s++)if(n=t[s],n&&n.length>=this.minlength&&!e[n]){if(!(this.optimize||l||this.map[n]))return c;i[h++]=n,e[n]=1}r=(t=i).length}if(!r)return c;e||(e=100);let u,a,g,d=this.depth&&r>1&&!1!==h,p=0;for(d?(u=t[0],p=1):r>1&&t.sort(s);p<r;p++){if(g=t[p],d?(a=this.add_result(c,l,e,f,2===r,g,u),l&&!1===a&&c.length||(u=g)):a=this.add_result(c,l,e,f,1===r,g),a)return a;if(l&&p===r-1){let t=c.length;if(!t){if(d){d=0,p=-1;continue}return c}if(1===t)return _(c[0],e,f)}}return x(c,e,f,l)}add_result(t,e,i,n,s,r,h){let o=[],l=h?this.ctx:this.map;if(this.optimize||(l=q(l,r,h,this.bidirectional)),l){let e=0;const c=Math.min(l.length,h?this.resolution_ctx:this.resolution);for(let t,f,u=0,a=0;u<c&&(t=l[u],!(t&&(this.optimize&&(t=q(t,r,h,this.bidirectional)),n&&t&&s&&(f=t.length,f<=n?(n-=f,t=null):(t=t.slice(n),n=0)),t&&(o[e++]=t,s&&(a+=t.length,a>=i)))));u++);if(e)return s?_(o,i,0):void(t[t.length]=o)}return!e&&o}contain(t){return!!this.register[t]}update(t,e){return this.remove(t).add(t,e)}remove(t,e){return this.register[t]&&(O(this.map,t,this.resolution,this.optimize),this.depth&&O(this.ctx,t,this.resolution_ctx,this.optimize),e||delete this.register[t],this.cache&&this.cache.del(t)),this}serialize(){return{reg:this.register,opt:this.optimize,map:this.map,ctx:this.ctx}}static deserialize(t,e){const i=new z(e);return i.optimize=t.opt,i.register=t.reg,i.map=t.map,i.ctx=t.ctx,i}}function w(t,e,i,n,s){return i&&t>1?e+(n||0)<=t?i+(s||0):(t-1)/(e+(n||0))*(i+(s||0))+1|0:0}function _(t,e,i){var n;return 1===t.length?t=t[0]:(n=t,t=[].concat.apply([],n)),i||t.length>e?t.slice(i,i+e):t}function q(t,e,i,n){if(i){const s=n&&e>i;t=(t=t[s?e:i])&&t[s?i:e]}else t=t[e];return t}function O(t,e,i,n,s){let h=0;if(r(t))if(s){const i=t.indexOf(e);-1!==i?t.length>1&&(t.splice(i,1),h++):h++}else{s=Math.min(t.length,i);for(let r,o=0;o<s;o++)r=t[o],r&&(h=O(r,e,i,n,s),n||h||delete t[o])}else for(let r in t)h=O(t[r],e,i,n,s),h||delete t[r];return h}z.prototype.searchCache=k,p(z.prototype);
/**!
   * FlexSearch.js
   * Copyright 2018-2021 Nextapps GmbH
   * Author: Thomas Wilkerling
   * Licence: Apache-2.0
   * https://github.com/nextapps-de/flexsearch
   */
class v{constructor(t){const e=t.document||t.doc||t;let i;this.tree=[],this.field=[],this.marker=[],this.register=n(),this.key=(i=e.key||e.id)&&j(i,this.marker)||"id",this.storetree=(i=e.store)&&!0!==i&&[],this.store=i&&n(),this.tag=(i=e.tag)&&j(i,this.marker),this.tagindex=i&&n(),this.cache=(i=t.cache)&&new b(i),t.cache=!1,this.worker=t.worker,this.async=!1,this.index=this.parse_descriptor(t,e)}add(t,e,i){if(o(t)&&(t=A(e=t,this.key)),e&&(t||0===t)){if(!i&&this.register[t])return this.update(t,e);for(let n,s,r=0;r<this.field.length;r++)s=this.field[r],n=this.tree[r],h(n)&&(n=[n]),P(e,n,this.marker,0,this.index[s],t,n[0],i);if(this.tag){let s=A(e,this.tag),r=n();h(s)&&(s=[s]);for(let e,n,h=0;h<s.length;h++)e=s[h],r[e]||(r[e]=1,n=this.tagindex[e]||(this.tagindex[e]=[]),i&&-1!==n.indexOf(t)||(n[n.length]=t))}if(this.store&&(!i||!this.store[t])){let i;if(this.storetree){i=n();for(let t,n=0;n<this.storetree.length;n++)t=this.storetree[n],h(t)?i[t]=e[t]:M(e,i,t,0,t[0])}this.store[t]=i||e}}return this}append(t,e){return this.add(t,e,!0)}update(t,e){return this.remove(t).add(t,e)}remove(t){if(o(t)&&(t=A(t,this.key)),this.register[t]){for(let e=0;e<this.field.length;e++)this.index[this.field[e]].remove(t,!this.worker);if(this.tag)for(let e in this.tagindex){const i=this.tagindex[e],n=i.indexOf(t);-1!==n&&(i.length>1?i.splice(n,1):delete this.tagindex[e])}this.store&&delete this.store[t],delete this.register[t]}return this}search(t,e,i,n){i||(!e&&o(t)?t=(i=t).query:o(e)&&(i=e,e=0));let s,l,c,f,u,a,g=[],d=[],p=0;if(i)if(r(i))c=i,i=null;else{if(s=i.pluck,c=s||i.index||i.field,f=i.tag,l=this.store&&i.enrich,u="and"===i.bool,e=i.limit||100,a=i.offset||0,f&&(h(f)&&(f=[f]),!t)){for(let t,i=0;i<f.length;i++)t=C.call(this,f[i],e,a,l),t&&(g[g.length]=t,p++);return p?g:[]}h(c)&&(c=[c])}c||(c=this.field),u=u&&(c.length>1||f&&f.length>1);const m=!n&&(this.worker||this.async)&&[];for(let s,r,o,l=0;l<c.length;l++){let b;if(r=c[l],h(r)||(b=r,r=r.field),m)m[l]=this.index[r].searchAsync(t,e,b||i);else{if(s=n?n[l]:this.index[r].search(t,e,b||i),o=s&&s.length,f&&o){const t=[];let i=0;u&&(t[0]=[s]);for(let e,n,s=0;s<f.length;s++)e=f[s],n=this.tagindex[e],o=n&&n.length,o&&(i++,t[t.length]=u?[n]:n);i&&(s=u?x(t,e||100,a||0):y(s,t),o=s.length)}if(o)d[p]=r,g[p++]=s;else if(u)return[]}}if(m){const n=this;return new Promise((function(s){Promise.all(m).then((function(r){s(n.search(t,e,i,r))}))}))}if(!p)return[];if(s&&(!l||!this.store))return g[0];for(let t,e=0;e<d.length;e++){if(t=g[e],t.length&&l&&(t=E.call(this,t)),s)return t;g[e]={"field":d[e],"result":t}}return g}contain(t){return!!this.register[t]}get(t){return this.store[t]}set(t,e){return this.store[t]=e,this}serialize(){const t={tag:this.tagIndex,reg:this.register,store:this.store,field:this.field,index:{}};return Object.entries(this.index).forEach((([e,i])=>{t.index[e]=i.serialize()})),t}static deserialize(t,e){const i=new v(e);return i.tagIndex=t.tag,i.register=t.reg,i.store=t.store,i.field=t.field,Object.entries(t.index).forEach((([e,n])=>{i.index[e]=z.deserialize(n),i.index[e].register=t.reg})),i}parse_descriptor(t,e){const i=n();let s=e.index||e.field||e;h(s)&&(s=[s]);for(let e,n,r=0;r<s.length;r++)e=s[r],h(e)||(n=e,e=e.field),n=o(n)?Object.assign({},t,n):t,this.worker||(i[e]=new z(n,this.register)),this.tree[r]=j(e,this.marker),this.field[r]=e;if(this.storetree){let t=e.store;h(t)&&(t=[t]);for(let e=0;e<t.length;e++)this.storetree[e]=j(t[e],this.marker)}return i}}function j(t,e){const i=t.split(":");let n=0;for(let s=0;s<i.length;s++)(t=i[s]).indexOf("[]")>=0&&(t=t.substring(0,t.length-2))&&(e[n]=!0),t&&(i[n++]=t);return n<i.length&&(i.length=n),n>1?i:i[0]}function A(t,e){if(h(e))t=t[e];else for(let i=0;t&&i<e.length;i++)t=t[e[i]];return t}function M(t,e,i,s,h){if(t=t[h],s===i.length-1)e[h]=t;else if(t)if(r(t)){e=e[h]=new Array(t.length);for(let n=0;n<t.length;n++)M(t,e,i,s,n)}else e=e[h]||(e[h]=n()),h=i[++s],M(t,e,i,s,h)}function P(t,e,i,n,s,h,o,l){if(t=t[o])if(n===e.length-1){if(r(t)){if(i[n]){for(let e=0;e<t.length;e++)s.add(h,t[e],!0,!0);return}t=t.join(" ")}s.add(h,t,l,!0)}else if(r(t))for(let r=0;r<t.length;r++)P(t,e,i,n,s,h,r,l);else o=e[++n],P(t,e,i,n,s,h,o,l)}function C(t,e,i,n){let s=this.tagindex[t],r=s&&s.length-i;if(r&&r>0)return(r>e||i)&&(s=s.slice(i,i+e)),n&&(s=E.call(this,s)),{"tag":t,"result":s}}function E(t){const e=new Array(t.length);for(let i,n=0;n<t.length;n++)i=t[n],e[n]={"id":i,"doc":this.store[i]};return e}v.prototype.searchCache=k,p(v.prototype),t.Document=v,t.Index=z,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=flexsearch.browser.js.map
